<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>Word Rush v1.0</title>
<style>
    .background-gif {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
    }
    .content {
        position: relative;
        z-index: 1;
        color: white;
        text-align: center;
        margin-top: 50px;
    }

  :root {
    --accent: #00ffc6;
    --bg-1: #0b0f14;
    --bg-2: #05070a;
  }

  @keyframes glowPulse {
    0% { text-shadow: 0 0 5px var(--accent), 0 0 20px var(--accent); }
    50% { text-shadow: 0 0 15px var(--accent), 0 0 40px var(--accent); }
    100% { text-shadow: 0 0 5px var(--accent), 0 0 20px var(--accent); }
  }
  @keyframes bgMove { from { background-position:0 0; } to { background-position:1000px 1000px; } }
  @keyframes fadeOut { to { opacity:0; transform:scale(1.5); } }
  @keyframes fadeInOut { 0% { opacity:0; transform:scale(0.7);} 10% {opacity:1; transform:scale(1);} 90% {opacity:1; transform:scale(1);} 100% {opacity:0; transform:scale(1.2);} }
  @keyframes shoot { from { transform: translateY(0); opacity:1; } to { transform: translateY(-90vh); opacity:0; } }
  @keyframes explode { to { transform: scale(4); opacity:0; } }

  html, body {
    height: 100%;
    margin: 0;
    font-family:"Courier New", monospace;
    color: #fff;
    background: radial-gradient(circle at center, var(--bg-1), var(--bg-2));
    display: flex;
    justify-content: center;
    align-items: flex-start;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
  }

  #gameContainer {
    width: 100%;
    max-width: 900px;
    height: 90vh; /* fixed height to avoid resizing */
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    margin: 5vh auto;
    border-radius: 8px;
    box-sizing: border-box;
  }

  #hud {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 18px;
    background: rgba(0,0,0,0.35);
    border-bottom: 1px solid var(--accent);
  }
  #hud #score {
    font-weight: 700;
    color: var(--accent);
  }
  #healthBar {
    width: 220px;
    height: 20px;
    border: 2px solid var(--accent);
    border-radius: 6px;
    overflow: hidden;
  }
  #bar {
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,#00ff99,#00ffc6,#0099ff);
    transition: width 0.25s linear;
  }

  #gameArea {
    position: relative;
    flex: 1 1 auto;
    margin: 0 10px;
    overflow: hidden;
    background: repeating-linear-gradient(45deg, #0c1117 0px, #0c1117 2px, #0b0f14 2px, #0b0f14 4px);
    animation: bgMove 20s linear infinite;
    border-bottom: 3px solid #ff0044;
    border-radius: 6px;
  }

  .word {
    position: absolute;
    font-size: clamp(14px,2.2vw,20px);
    color: var(--accent);
    animation: glowPulse 1.6s infinite;
    white-space: nowrap;
    user-select: none;
  }
  .beam {
    position: absolute;
    width: 2px;
    background: linear-gradient(to top,var(--accent),transparent);
    animation: shoot 0.22s linear forwards;
  }
  .explosion {
    position: absolute;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: radial-gradient(circle,#fff,var(--accent));
    animation: explode 0.28s ease-out forwards;
  }
  .scorePop {
    position: absolute;
    font-size: 14px;
    color: var(--accent);
    transform-origin: center;
    animation: fadeOut 0.6s ease-out forwards;
  }

  #inputArea {
    text-align: center;
    padding: 10px;
    bottom: 1vh;
    width: 100%;
    box-sizing: border-box;
  }
  input[type="text"] {
    width: 62%;
    max-width: 760px;
    padding: 10px 12px;
    font-size: clamp(16px,2vw,18px);
    background: rgba(0,0,0,0.3);
    color: var(--accent);
    border: 1px solid var(--accent);
    border-radius: 6px;
    outline: none;
  }

  #overlay {
    position: fixed;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.96);
    color: var(--accent);
    z-index: 9999;
    text-align: center;
    padding: 20px;
    opacity: 1;
    transition: opacity 1s, transform 1s;
  }
  #overlay h1 {
    font-size: 2.4rem;
    margin: 0 0 12px;
    animation: glowPulse 2s infinite;
  }
  
  #overlay footer {
    margin-top: 25px;
    font-size: 0.9rem;
    opacity: 0.7;
  }
  #overlay #aboutLink {
    margin-top: 8px;
    font-size: 0.95rem;
    color: var(--accent);
    cursor: pointer;
    text-decoration: underline;
  }

  .menu-btn {
    margin-top: 8px;
    padding: 10px 22px;
    border-radius: 8px;
    border: 2px solid var(--accent);
    background: transparent;
    color: var(--accent);
    cursor: pointer;
    font-size: 1.1rem;
  }
  #btnRow {
    display: flex;
    gap: 10px;
    justify-content: center;
    flex-wrap: wrap;
  }

  .modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.85);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    display: none;
    flex-direction: column;
    color: #fff;
    text-align: center;
  }
  .modal-content {
    background: rgba(20,20,30,0.9);
    padding: 20px;
    border: 2px solid var(--accent);
    border-radius: 10px;
    width: 320px;
    max-height: 520px;
    overflow-y: auto;
  }
  .modal button {
    margin: 5px;
    padding: 8px 16px;
    border: none;
    background: var(--accent);
    color: #000;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
  }
  .closeModal {
    margin-top: 10px;
    background: #222;
    color: var(--accent);
    border: 1px solid var(--accent);
  }

  /* Difficulty Selector Style (minimal/clean) */
  #difficultyContainer {
    margin-top: 15px;
    color: var(--accent);
    display: flex;
    align-items: center;
    gap: 12px;
    justify-content: center;
  }
  /* hide raw radio input */
  .diff-radio { display:none; }
  .diff-btn {
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:8px 14px;
    border-radius:999px;
    border: 1px solid rgba(255,255,255,0.08);
    background: rgba(255,255,255,0.02);
    color: rgba(255,255,255,0.9);
    cursor:pointer;
    transition: all 180ms ease;
    font-weight:600;
    letter-spacing:0.6px;
    min-width:80px;
    justify-content:center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.45);
  }
  .diff-btn:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
  }
  .diff-btn.selected {
    background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border: 1px solid rgba(255,255,255,0.12);
    color: var(--accent);
    box-shadow: 0 8px 28px color-mix(in srgb, var(--accent) 40%, transparent);
  }
  /* small color dot next to difficulty name */
  .diff-dot {
    width:10px;height:10px;border-radius:50%;
    background: rgba(255,255,255,0.12);
    box-shadow: 0 0 8px rgba(0,0,0,0.6);
  }
  .diff-btn[data-diff="easy"] .diff-dot { background: rgba(0,255,198,0.85); }
  .diff-btn[data-diff="medium"] .diff-dot { background: rgba(255,215,0,0.85); }
  .diff-btn[data-diff="hard"] .diff-dot { background: rgba(255,90,90,0.85); }

  /* Top Scores layout in overlay */
  #topScores { margin-top:16px; color:var(--accent); text-align:center; }

  /* Theme presets & custom UI */
  .theme-presets { display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-bottom:12px; }
  .theme-card {
    width:72px; height:50px; border-radius:8px; cursor:pointer;
    border:2px solid rgba(255,255,255,0.06); overflow:hidden; box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    transition: transform 150ms ease, box-shadow 150ms ease, border-color 150ms ease;
  }
  .theme-card:hover { transform:translateY(-6px); box-shadow:0 14px 30px rgba(0,0,0,0.6); border-color: rgba(255,255,255,0.12); }
  .theme-card .bar { height:100%; width:100%; background:linear-gradient(180deg,#fff,#000); opacity:0.9; }

  .custom-theme-row { display:flex; flex-direction:column; gap:8px; margin-top:10px; align-items:center; }
  .color-inputs { display:flex; gap:8px; justify-content:center; margin-top:6px; flex-wrap:wrap; }
  .color-inputs label { font-size:13px; color:var(--accent); display:flex; gap:6px; align-items:center; }

  /* Game Over Modal */
  #gameOverModal {
    position: fixed;
    inset: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,0.95);
    color: var(--accent);
    z-index: 10001;
    text-align: center;
    font-size: 1.8rem;
    font-weight: bold;
    padding: 20px;
    opacity: 0;
    transform: scale(0.7);
    pointer-events: none;
    transition: opacity 0.5s, transform 0.5s;
  }
  #gameOverModal.show {
    opacity: 1;
    transform: scale(1);
    pointer-events: auto;
  }

  /* Prevent gameArea resizing on mobile keyboard */
  @media (max-width: 700px) {
    #gameContainer {
      height: 75vh;
    }
    input[type="text"] {
      width: 80%;
    }
    .modal-content { width: 92%; max-height: 80vh; }
  }
</style>
</head>
<body>
    
<img src="background.gif" class="background-gif" alt="bg"></img>
<div class="content"></div>
    
<div id="gameContainer">
  <div id="overlay">
    <h1>WORD RUSH</h1>
    <p>Type fast and defend.<br>⣿⠿⠿⠛⠛⠛⠟⠿⠻⣿⣿⡿⠿⠿⠛⠛⠛⠛⠿⢿
⣷⣴⣾⠿⠿⠿⣷⢶⢾⣿⣿⡿⢶⡶⠿⠻⠛⣿⣶⣽
⣿⣿⣏⠶⠀⠀⠭⢺⣺⣿⣿⣧⣺⠧⠄⠀⡰⢛⣽⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣿
⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣿⢏⣾⣿
⣿⣿⣿⣿⣿⠻⠿⠿⠿⠿⠿⠿⢛⣛⣭⣾⣿⣸⣿⣿
⣿⣿⣿⣿⣿⣾⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣧⣿⣿⣿<br>*Not for slow fingers.*<br></p>

    <div id="difficultyContainer" aria-label="Difficulty">
      <span style="opacity:0.8;margin-right:6px;"></span>

      <!-- radios are still present (hidden) so existing code works -->
      <input id="diff_easy" class="diff-radio" type="radio" name="difficulty" value="easy" checked>
      <label class="diff-btn selected" for="diff_easy" data-diff="easy" tabindex="0">
        <span class="diff-dot"></span><span style="margin-left:6px;">Easy</span>
      </label>

      <input id="diff_medium" class="diff-radio" type="radio" name="difficulty" value="medium">
      <label class="diff-btn" for="diff_medium" data-diff="medium" tabindex="0">
        <span class="diff-dot"></span><span style="margin-left:6px;">Medium</span>
      </label>

      <input id="diff_hard" class="diff-radio" type="radio" name="difficulty" value="hard">
      <label class="diff-btn" for="diff_hard" data-diff="hard" tabindex="0">
        <span class="diff-dot"></span><span style="margin-left:6px;">Hard</span>
      </label>
    </div>

    <button id="startBtn" class="menu-btn">START</button>
    <div id="btnRow">
      <button id="musicBtn" class="menu-btn">Music</button>
      <button id="themeBtn" class="menu-btn">Theme</button>
    </div>
    <div id="topScores"></div>
    <footer>© 2025 Word Rush. All rights reserved.</footer>
    <div id="aboutLink">about</div>
  </div>  

  <div id="hud">
    <div>Score: <span id="score">0</span></div>
    <div><div id="healthBar"><div id="bar"></div></div></div>
  </div>

  <div id="gameArea" aria-live="polite"></div>

  <div id="inputArea">
    <input id="input" type="text" placeholder="Type here..." autocomplete="off" disabled>
  </div>
</div>

<audio id="bgMusic" loop>
  <source src="default.mp3" type="audio/mpeg">
</audio>

<!-- MUSIC MODAL -->
<div id="musicModal" class="modal" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h3>Background Music</h3>
    <button id="uploadMusic">Upload Custom</button>
    <input id="volumeControl" type="range" min="0" max="1" step="0.05" value="0.4" style="width:100%;">
    <button class="closeModal" onclick="closeModal('musicModal')">Close</button>
  </div>
</div>

<!-- THEME MODAL -->
<div id="themeModal" class="modal" role="dialog" aria-modal="true">
  <div class="modal-content">
    <h3>Select Theme</h3>

    <!-- preset cards -->
    <div class="theme-presets" id="presetCards">
      <div class="theme-card" data-key="dark" title="Dark">
        <div class="bar" style="background: linear-gradient(180deg,#0b0f14,#05070a)"></div>
      </div>
      <div class="theme-card" data-key="neon" title="Neon">
        <div class="bar" style="background: linear-gradient(180deg,#ff00ff,#150022)"></div>
      </div>
      <div class="theme-card" data-key="space" title="Space">
        <div class="bar" style="background: linear-gradient(180deg,#00ccff,#020824)"></div>
      </div>
      <div class="theme-card" data-key="fire" title="Fire">
        <div class="bar" style="background: linear-gradient(180deg,#ff6600,#400000)"></div>
      </div>
      <div class="theme-card" data-key="ice" title="Ice">
        <div class="bar" style="background: linear-gradient(180deg,#66ffff,#003344)"></div>
      </div>
    </div>

    <div style="width:100%;height:1px;background:rgba(255,255,255,0.03);margin:8px 0;"></div>

    <!-- Custom theme -->
    <div class="custom-theme-row">
      <strong style="color:var(--accent)">Custom Theme</strong>
      <div class="color-inputs">
        <label>Accent <input id="colorAccent" type="color" value="#00ffc6"></label>
        <label>BG Top <input id="colorBg1" type="color" value="#0b0f14"></label>
        <label>BG Bot <input id="colorBg2" type="color" value="#05070a"></label>
      </div>

      <div style="display:flex;gap:8px;justify-content:center;margin-top:8px;">
        <button id="applyCustomBtn">Apply</button>
        <button id="saveCustomBtn">Save</button>
        <button class="closeModal" onclick="closeModal('themeModal')">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- ABOUT MODAL -->
<div id="aboutModal" class="modal">
  <div class="modal-content" style="max-height: 300px; overflow-y: auto;">
    <h3>About Word Rush</h3>
    <p>
      Fast-paced typing game for killing boredom or flexing your typing skills. <br><br>Developed solo with a help from AI and NCS beats.<br>
      
<br><br>Contact/support:<br> iamfinix0172@gmail.com

<br><br>
<strong>v1.0 – Initial release.</strong>
    </p>
    <button class="closeModal" onclick="closeModal('aboutModal')">Close</button>
  </div>
</div>

<!-- GAME OVER MODAL -->
<div id="gameOverModal">
  <div id="gameOverText"></div>
  <button id="menuBtn" class="menu-btn">Menu</button>
</div>

<script>
const MAX_ACTIVE=10;
const BASE_FALL_SPEED=40;
const SPEED_INCREASE_PER_SEC=1.8;

const spawnIntervals = {
  easy: 2500,
  medium: 2000,
  hard: 1400
};

const baseSpeeds = {
  easy: 25,
  medium: BASE_FALL_SPEED,
  hard: 65
};

const 
WORD_LIST=[
"ash","bar","bay","cap","cog","cub","cup","dew","fog","fox","hum","ice","jug","lid","log","mug","net","owl","pan","peg","pin","pot","ram","rim","rod","sap","sky","sun","tap","toad","twig","vine","wave","wire","wolf","wisp","wing","worm","yarn",
"bark","belt","beet","bolt","bowl","brim","cape","cave","coal","coil","cord","corn","cove","crag","curl","dawn","dusk","echo","fern","flake","flint","flame","fawn","gale","gear","gleam","glow","glint","gloom","grid","hill","hook","horn","hunt","hush","isle","jade","lake","lark","leaf","lumen","maze","mesh","mist","moon","moss","mire","nest","path","peak","pike","pine","pond","quill","rack","rift","ring","rock","rope","rose","root","rush","salt","sand","scar","seed","shade","shale","shard","shore","smoke","snag","snare","snow","soil","sound","spark","spike","spire","sprig","star","steam","steel","stone","storm","strap","stream","sunny","swirl","tarn","thorn","tide","tile","time","trail","tree","vein","veil","vine","wave","wind","wood",
"beach","block","bloom","bough","brick","brook","burrow","cinder","cliff","clump","crane","creek","crest","crust","dusty","ember","field","flick","flood","frost","glisten","grain","grass","grove","harp","haven","hollow","knoll","laden","lagoon","lichen","mangle","marsh","meadow","mellow","mottle","muddle","orchard","pebble","petal","plank","plume","ripple","river","sapling","savage","scout","shadow","shoreline","shimmer","sleet","smelt","sparkle","spirit","streamer","swamp","thatch","thorny","thicket","tidal","timber","valley","wicker","willow","wither","withered",
"ancient","ashenwood","asunder","bastion","beetle","blossom","boundless","bramble","brightwind","caravan","cascade","citadel","citronel","cinderfall","chromium","crescent","cavalry","chimera","cobble","crimson","deepwood","drifter","emberfall","evermore","feathered","firebrand","fountain","foreseen","glacial","galleon","gilded","gossamer","granite","harvest","hearthstone","heirloom","honeycomb","hivemind","horizon","ironwood","labyrinth","lantern","lichen","longhorn","luminous","mariner","meadow","monarch","moonbeam","moonrise","nightfall","opaline","orchard","paladin","parable","phantom","pilgrim","radiant","ravenous","resonant","rosewood","runestone","saffron","sanctum","seabound","seabreeze","serpent","shadowed","shimmer","silence","solaria","solstice","spellfire","spellbound","sorcery","starfall","starling","stormborn","stormtide","sundown","sungazer","talisman","thymeleaf","tranquil","torrent","underglow","undertow","vagrant","vanguard","valiance","voyager","wanderer","wayfarer","whisper","whimsey","willow","windswept","wisteria","wolfsbane"
];

const gameArea=document.getElementById("gameArea"), input=document.getElementById("input"),
      scoreEl=document.getElementById("score"), barEl=document.getElementById("bar"),
      overlay=document.getElementById("overlay"), startBtn=document.getElementById("startBtn"),
      musicBtn=document.getElementById("musicBtn"), bgMusic=document.getElementById("bgMusic"),
      themeBtn=document.getElementById("themeBtn"), topScoresDiv=document.getElementById("topScores"),
      gameOverModal=document.getElementById("gameOverModal"),
      gameOverText=document.getElementById("gameOverText"),
      menuBtn=document.getElementById("menuBtn"),
      aboutLink=document.getElementById("aboutLink");

let activeWords=[], score=0, health=100, spawnTimer=null, running=false, lastFrame=null, startTime=0;

// ⬇ High scores per difficulty (stored as an object)
let highScores = JSON.parse(localStorage.getItem("wordRushScores") || `{
  "easy":[],
  "medium":[],
  "hard":[]
}`);

// Theme storage keys
const THEME_STORE_KEY = "wordRushCustomTheme";

// Default presets mapping
const PRESET_THEMES = {
  dark: { accent:"#00ffc6", bg1:"#0b0f14", bg2:"#05070a" },
  neon: { accent:"#ff00ff", bg1:"#0a0014", bg2:"#150022" },
  space: { accent:"#00ccff", bg1:"#000010", bg2:"#020824" },
  fire: { accent:"#ff6600", bg1:"#200000", bg2:"#400000" },
  ice: { accent:"#66ffff", bg1:"#001020", bg2:"#003344" }
};

let currentDifficulty = "easy";
let currentBaseSpeed = baseSpeeds[currentDifficulty];
let currentSpawnInterval = spawnIntervals[currentDifficulty];

function openModal(id){document.getElementById(id).style.display="flex";}
function closeModal(id){document.getElementById(id).style.display="none";}
musicBtn.onclick=()=>openModal("musicModal");
themeBtn.onclick=()=>openModal("themeModal");
aboutLink.onclick=()=>openModal("aboutModal");
menuBtn.onclick=()=>{
  gameOverModal.classList.remove("show");
  overlay.style.display = "flex";
};

document.getElementById("uploadMusic").onclick=()=>{
  const picker=document.createElement("input");
  picker.type="file"; picker.accept="audio/*";
  picker.onchange=e=>{
    const file=e.target.files[0];
    if(file){
      bgMusic.src=URL.createObjectURL(file);
      alert("Custom music loaded!");
    }
  };
  picker.click();
};
document.getElementById("volumeControl").oninput=e=>bgMusic.volume=e.target.value;

/* Apply theme to document root */
function applyTheme(themeObj, save=false){
  if(!themeObj) return;
  const root=document.documentElement;
  root.style.setProperty("--accent", themeObj.accent);
  root.style.setProperty("--bg-1", themeObj.bg1);
  root.style.setProperty("--bg-2", themeObj.bg2);

  // update color pickers to reflect applied values (if present)
  const ca=document.getElementById("colorAccent");
  const cb=document.getElementById("colorBg1");
  const cc=document.getElementById("colorBg2");
  if(ca) ca.value = themeObj.accent;
  if(cb) cb.value = themeObj.bg1;
  if(cc) cc.value = themeObj.bg2;

  if(save) {
    localStorage.setItem(THEME_STORE_KEY, JSON.stringify(themeObj));
  }
}

/* Load saved custom theme (if exists) */
function loadSavedTheme(){
  const raw=localStorage.getItem(THEME_STORE_KEY);
  if(raw){
    try{
      const t=JSON.parse(raw);
      applyTheme(t,false);
    }catch(e){}
  }
}

/* setTheme called by preset buttons/cards */
function setTheme(key){
  const theme = PRESET_THEMES[key];
  if(theme){
    applyTheme(theme, false);
    // save last chosen preset as current custom so next session keeps it
    localStorage.setItem(THEME_STORE_KEY, JSON.stringify(theme));
  }
  // close modal
  closeModal('themeModal');
}

/* Hook up preset card clicks */
document.querySelectorAll('.theme-card').forEach(card=>{
  card.addEventListener('click',()=>{
    const key = card.dataset.key;
    setTheme(key);
  });
});

/* Custom theme apply/save buttons */
document.getElementById('applyCustomBtn').addEventListener('click', ()=>{
  const theme = {
    accent: document.getElementById('colorAccent').value,
    bg1: document.getElementById('colorBg1').value,
    bg2: document.getElementById('colorBg2').value
  };
  applyTheme(theme, false);
});
document.getElementById('saveCustomBtn').addEventListener('click', ()=>{
  const theme = {
    accent: document.getElementById('colorAccent').value,
    bg1: document.getElementById('colorBg1').value,
    bg2: document.getElementById('colorBg2').value
  };
  applyTheme(theme, true);
  alert("Custom theme saved!");
});

function spawnExplosion(x,y){
  const ex=document.createElement("div");
  ex.className="explosion";
  ex.style.left=(x-6)+"px";
  ex.style.top=(y-6)+"px";
  gameArea.appendChild(ex);
  setTimeout(()=>ex.remove(),320);
}

function spawnBeam(x,y){
  const b=document.createElement("div");
  b.className="beam";
  b.style.left=(x-1)+"px";
  b.style.top=(gameArea.clientHeight*0.9)+"px";
  b.style.height=Math.max(20,gameArea.clientHeight*0.9-y)+"px";
  gameArea.appendChild(b);
  setTimeout(()=>b.remove(),240);
}

function spawnScorePopup(x,y,val){
  const p=document.createElement("div");
  p.className="scorePop";
  p.style.left=x+"px";
  p.style.top=(y-18)+"px";
  p.textContent="+"+val;
  gameArea.appendChild(p);
  setTimeout(()=>p.remove(),600);
}

function spawnWord(){
  const txt=WORD_LIST[Math.floor(Math.random()*WORD_LIST.length)];
  const el=document.createElement("div");
  el.className="word";
  el.textContent=txt;
  const x=Math.random()*(gameArea.clientWidth-100);
  el.style.left=x+"px";
  el.style.top="-8px";
  gameArea.appendChild(el);
  activeWords.push({el,y:-8,x,speed: currentBaseSpeed});
}

function removeWord(i){
  if(activeWords[i]){
    activeWords[i].el.remove();
    activeWords.splice(i,1);
  }
}

function trySpawn(){ if(running && activeWords.length<MAX_ACTIVE) spawnWord(); }

function gameLoop(ts){
  if(!lastFrame) lastFrame=ts;
  const dt=(ts-lastFrame)/1000; 
  lastFrame=ts;
  const elapsed=(ts-startTime)/1000;
  const diffBoost=Math.floor(elapsed/10)*SPEED_INCREASE_PER_SEC;

  for(let i=activeWords.length-1;i>=0;i--){
    const w=activeWords[i];
    w.y+=(w.speed+diffBoost)*dt;
    w.el.style.top=w.y+"px";
    if(w.y>gameArea.clientHeight*0.9){
      removeWord(i);
      health=Math.max(0,health-12);
      barEl.style.width=health+"%";
      if(health<=0) return endGame();
    }
  }

  if(running) requestAnimationFrame(gameLoop);
}

function startGame(){
  const selected=document.querySelector('input[name="difficulty"]:checked');
  currentDifficulty=selected ? selected.value : "easy";
  currentBaseSpeed=baseSpeeds[currentDifficulty];
  currentSpawnInterval=spawnIntervals[currentDifficulty];

  running=true; score=0; health=100; lastFrame=null;
  scoreEl.textContent=score; barEl.style.width="100%";
  activeWords.forEach(w=>w.el.remove()); activeWords=[];

  overlay.style.display="none"; 
  input.disabled=false; input.value=""; input.focus();

  if(spawnTimer) clearInterval(spawnTimer);
  spawnTimer=setInterval(trySpawn,currentSpawnInterval);
  trySpawn(); 
  startTime=performance.now();
  requestAnimationFrame(gameLoop);

  bgMusic.volume=0.4; 
  bgMusic.currentTime=0; 
  bgMusic.play().catch(()=>{});
}

function endGame(){
  running=false;
  if(spawnTimer) clearInterval(spawnTimer);
  bgMusic.pause();

  // Save score to correct category
  highScores[currentDifficulty].push(score);
  highScores[currentDifficulty].sort((a,b)=>b-a);
  highScores[currentDifficulty]=highScores[currentDifficulty].slice(0,3);
  localStorage.setItem("wordRushScores",JSON.stringify(highScores));
  displayTopScores();

  gameOverText.textContent=`GAME OVER!\nFinal Score: ${score}`;
  gameOverModal.classList.add("show");

  input.disabled=true;
}


/* Display Top Scores — three columns */
function displayTopScores(){
  topScoresDiv.innerHTML = `
  <h4>🏆 TOP SCORES</h4>
  <div style="display:flex;justify-content:center;gap:25px;margin-top:10px;">
    <div style="min-width:90px;"><strong>EASY</strong><br>${formatScores("easy")}</div>
    <div style="min-width:90px;"><strong>MEDIUM</strong><br>${formatScores("medium")}</div>
    <div style="min-width:90px;"><strong>HARD</strong><br>${formatScores("hard")}</div>
  </div>`;
}

function formatScores(diff){
  const arr = highScores[diff] || [];
  if(!arr.length) return "—";
  return arr.map((s,i)=>`${i+1}. ${s}`).join("<br>");
}

/* Difficulty button UI handling (sync label selected state with radio) */
function updateDifficultyUI(){
  document.querySelectorAll('.diff-btn').forEach(btn=>{
    const key = btn.dataset.diff;
    const radio = document.querySelector(`input[name="difficulty"][value="${key}"]`);
    if(radio && radio.checked){
      btn.classList.add('selected');
    } else {
      btn.classList.remove('selected');
    }
  });
}
document.querySelectorAll('.diff-btn').forEach(btn=>{
  btn.addEventListener('click', (e)=>{
    const key = btn.dataset.diff;
    const radio = document.querySelector(`input[name="difficulty"][value="${key}"]`);
    if(radio){
      radio.checked = true;
      updateDifficultyUI();
    }
  });
  // keyboard accessible
  btn.addEventListener('keydown', (e)=>{
    if(e.key === "Enter" || e.key === " ") { e.preventDefault(); btn.click(); }
  });
});
/* Also update UI on radio change (in case changed programmatically) */
document.querySelectorAll('input[name="difficulty"]').forEach(r=>{
  r.addEventListener('change', updateDifficultyUI);
});
updateDifficultyUI();

/* Load saved topScores (already in highScores var) and saved theme */
displayTopScores();
loadSavedTheme();

input.addEventListener("input",()=>{
  const typed=input.value.trim();
  if(!typed) return;
  for(let i=0;i<activeWords.length;i++){
    const w=activeWords[i];
    if(w.el.textContent===typed){
      const rect=w.el.getBoundingClientRect(), gr=gameArea.getBoundingClientRect();
      const x=rect.left-gr.left+(w.el.offsetWidth/2), y=rect.top-gr.top+(w.el.offsetHeight/2);
      spawnBeam(x,y); spawnExplosion(x,y); spawnScorePopup(x,y,10);
      score+=10; scoreEl.textContent=score; removeWord(i);
      input.value=""; break;
    }
  }
});

startBtn.addEventListener("click",startGame);

/* Close modals when clicking outside modal-content */
document.querySelectorAll('.modal').forEach(mod=>{
  mod.addEventListener('click', (e)=>{
    if(e.target === mod) mod.style.display = 'none';
  });
});
</script>
</body>
</html>